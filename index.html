<!DOCTYPE html>
<html>
<head>
  <title>WebRTC Chat (No Backend)</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: auto; }
    h2 { text-align: center; }
    textarea { width: 100%; height: 100px; margin-top: 5px; }
    #chat { border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: auto; margin-top: 10px; }
    .section { margin-bottom: 20px; }
    button { margin-top: 5px; }
    label { font-weight: bold; display: block; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Peer-to-Peer Chat (WebRTC, No Backend)</h2>

  <div class="section">
    <label for="offer">Step 1 (Alice): Create Offer → Copy and send to Bob</label>
    <button id="createOffer">Create Offer</button>
    <textarea id="offer" placeholder="Offer will appear here..."></textarea>
  </div>

  <div class="section">
    <label for="offer">Step 2 (Bob): Paste Alice’s Offer here, then click Set Offer</label>
    <button id="setOffer">Set Offer</button>
  </div>

  <div class="section">
    <label for="answer">Step 3 (Bob): Copy Answer → Send back to Alice</label>
    <button id="createAnswer">Create Answer</button>
    <textarea id="answer" placeholder="Answer will appear here..."></textarea>
  </div>

  <div class="section">
    <label for="answer">Step 4 (Alice): Paste Bob’s Answer here, then click Set Answer</label>
    <button id="setAnswer">Set Answer</button>
  </div>

  <h3>Chat Window</h3>
  <div id="chat"></div>
  <input id="msg" placeholder="Type a message">
  <button id="sendBtn">Send</button>

  <script>
    let pc = new RTCPeerConnection();
    let channel = pc.createDataChannel("chat");
    let chatBox = document.getElementById("chat");

    channel.onmessage = e => {
      chatBox.innerHTML += "<p><b>Peer:</b> " + e.data + "</p>";
    };

    document.getElementById("sendBtn").onclick = () => {
      let msg = document.getElementById("msg").value;
      if (msg.trim() !== "") {
        channel.send(msg);
        chatBox.innerHTML += "<p><b>You:</b> " + msg + "</p>";
        document.getElementById("msg").value = "";
      }
    };

    // Create Offer
    document.getElementById("createOffer").onclick = async () => {
      let offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      document.getElementById("offer").value = JSON.stringify(offer);
    };

    // Set Offer from Peer
    document.getElementById("setOffer").onclick = async () => {
      let offer = JSON.parse(document.getElementById("offer").value);
      await pc.setRemoteDescription(offer);
      let answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
      document.getElementById("answer").value = JSON.stringify(answer);
    };

    // Set Answer from Peer
    document.getElementById("setAnswer").onclick = async () => {
      let answer = JSON.parse(document.getElementById("answer").value);
      await pc.setRemoteDescription(answer);
    };

    // When answer side creates channel
    pc.ondatachannel = e => {
      e.channel.onmessage = ev => {
        chatBox.innerHTML += "<p><b>Peer:</b> " + ev.data + "</p>";
      };
      channel = e.channel;
    };
  </script>
</body>
</html>
