<!DOCTYPE html>
<html>
<head>
  <title>WebRTC Chat (No Backend)</title>
  <style>
    body { font-family: Arial; }
    textarea { width: 100%; height: 100px; }
    #chat { border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: auto; }
  </style>
</head>
<body>
  <h2>Peer-to-Peer Chat (WebRTC, no backend)</h2>
  
  <div>
    <button id="createOffer">Create Offer</button>
    <textarea id="offer"></textarea>
  </div>
  
  <div>
    <button id="createAnswer">Create Answer</button>
    <textarea id="answer"></textarea>
  </div>
  
  <div>
    <button id="setOffer">Set Offer</button>
    <button id="setAnswer">Set Answer</button>
  </div>

  <div id="chat"></div>
  <input id="msg" placeholder="Type a message">
  <button id="sendBtn">Send</button>

  <script>
    let pc = new RTCPeerConnection();
    let channel = pc.createDataChannel("chat");
    let chatBox = document.getElementById("chat");

    channel.onmessage = e => {
      chatBox.innerHTML += "<p><b>Peer:</b> " + e.data + "</p>";
    };

    document.getElementById("sendBtn").onclick = () => {
      let msg = document.getElementById("msg").value;
      channel.send(msg);
      chatBox.innerHTML += "<p><b>You:</b> " + msg + "</p>";
      document.getElementById("msg").value = "";
    };

    // Create Offer
    document.getElementById("createOffer").onclick = async () => {
      let offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      document.getElementById("offer").value = JSON.stringify(offer);
    };

    // Set Offer from Peer
    document.getElementById("setOffer").onclick = async () => {
      let offer = JSON.parse(document.getElementById("offer").value);
      await pc.setRemoteDescription(offer);
      let answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
      document.getElementById("answer").value = JSON.stringify(answer);
    };

    // Set Answer from Peer
    document.getElementById("setAnswer").onclick = async () => {
      let answer = JSON.parse(document.getElementById("answer").value);
      await pc.setRemoteDescription(answer);
    };

    // When answer side creates channel
    pc.ondatachannel = e => {
      e.channel.onmessage = ev => {
        chatBox.innerHTML += "<p><b>Peer:</b> " + ev.data + "</p>";
      };
      channel = e.channel;
    };
  </script>
</body>
</html>
